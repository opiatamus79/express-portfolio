<div id="gray-bg">
  <div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
      <h2>Support Tickets</h2>
      <ol class="breadcrumb">
        <li>
          <a [routerLink]="['/']">{{globals.city}}</a>
        </li>
        <li class="active">
          <strong>Support Tickets</strong>
        </li>
      </ol>
    </div>

  </div>
<div class="wrapper wrapper-content animated fadeIn">
  <div class="row">
    <div class="col-sm-12">
      <div class="ibox">
      <div class="ibox-content">
          <!-- <span class="text-muted small pull-right">Last update: -->
            <!-- <i class="fa fa-clock-o"></i> 2:10 pm - 12.06.2014</span> -->
          <h2>Tickets</h2>
          <p>
            List of submitted tickets.
          </p>
          <div class="row">
            <div class="col-sm-6 col-xs-12">
              <input #searchBox type="text" placeholder="Search" class="input form-control" id="search-box" (keyup)="search()" [(ngModel)]="searchText">
              <div class="form-control-feedback clear-search-padding" *ngIf="searchText">
                <a class="clear-search" (click)="clearSearchText()">
                  <i class="fa fa-times-circle"></i>
                </a>
              </div>
            </div>
            <div class="col-sm-3 col-xs-12">
                <select class="search-status form-control" name="statusSelect" tabindex="2" [(ngModel)]="searchTicketStatus" (change)="search()" >
                  <option disabled value="">Status</option>
                  <option value="">All</option>
                  <option *ngFor="let status of ticketStatuses" [value]="status.id" >{{status.name}}</option>
                </select>
            </div>
            <div class="col-sm-3 col-xs-12">
              <select class=" form-control" name="typeSelect" tabindex="2" [(ngModel)]="searchTicketType" (change)="search()">
                <option fxShow.lt-lg="false" fxShow="true" disabled value="">Type</option>
                <option value="">All</option>
                <option *ngFor="let types of ticketTypes" [value]="types.name">{{types.name}}</option>
              </select>
            </div>
          </div>
          <div class="row">
            <!-- <input type="text" class="form-control" #dp="bsDatepicker" bsDatepicker [bsValue]="bsValue"> -->
          </div>

          <hr>

          <div class="row">
              <div fxShow.gt-xs="false" fxShow="true" class="col-xs-12 text-left">
                <i style="margin-right:5px" class="fa fa-info-circle fa-lg"></i>
                <span class="h5 text-muted">Click or touch a ticket to view the details.</span>
              </div>
              <br>
              <br>
              <div class="col-xs-12">
                <span class="pull-right small text-muted">{{this.paginationTotalTickets}} Tickets</span>
              </div>
          </div>
          <div>
            <div class="ibox-content spinner" [hidden]="!loading">
              <div class="">
                <div class="sk-spinner sk-spinner-three-bounce">
                  <div class="sk-bounce1"></div>
                  <div class="sk-bounce2"></div>
                  <div class="sk-bounce3"></div>
                </div>
              </div>
            </div>
            <div class="no-tickets-text" [hidden]="loading || (tickets$ | async)?.tickets.length">
              <hr>
              <h2>No tickets found</h2>
              <hr>
            </div>
            <div class="user-height-scroll" [hidden]="loading || (tickets$ | async)?.tickets.length == 0">
              <div class="table-responsive">
                <table style="overflow-x:scroll;" class="footable table table-responsive table-stripped toggle-arrow-tiny" data-filter="#filter">
                  <thead>
                    <tr fxShow.lt-lg="false" fxShow="true">
                      <th width="50px">Ticket No.</th>
                      <th class="text-center">Date Created</th>
                      <th *ngIf="user?.user_type_id !=3">Customer</th>
                      <th class="text-center">Account</th>
                      <th class="text-center">Category</th>
                      <th class="text-center">Title</th>
                      <th class="text-center">Images</th>
                      <th class="text-center">Status</th>
                      <th></th>
                    </tr>
                    <tr fxShow.xs="false" fxShow.gt-md="false" fxShow="true">
                        <th width="50px">Ticket No.</th>
                        <th class="text-center">Date Created</th>
                        <th *ngIf="user?.user_type_id !=3">Customer</th>
                        <th class="text-center">Account</th>
                        <th class="text-center">Ticket</th>
                        <th></th>
                      </tr>
                    <tr fxShow.gt-xs="false" fxShow="true">
                      <th class="text-center" width="50px">Ticket</th>
                      <!--<th class="text-center">Date Created</th>-->
                      <!--<th>Title</th>
                                            -->
                      <th class="text-center" *ngIf="user?.user_type_id !=3">Customer Info</th>
                      <th class="text-center" *ngIf="user.user_type_id == 3" class="text-center">Account</th>
                      <th class="text-center" *ngIf="user.user_type_id == 3">Status</th>
                    </tr>
                  </thead>
                  <tbody fxShow.lt-lg="false" fxShow="true"  class="borderless-table" *ngFor="let ticket of (tickets$ | async)?.tickets">
                    <tr *ngIf="ticket?.ticket_type_id != 11">
                      <td class="table-break">{{ticket?.id}}</td>
                      <td class="text-center">
                        <h4>
                         {{ticket?.date_created | date: 'mediumDate'}}
                        </h4>
                        <small>
                          {{ticket?.date_created | dateDiff}}
                        </small>
                      </td>
                      <td *ngIf="user?.user_type_id !=3">
                        <div class="feed-element">
                          <a class="pull-left">
                            <!-- <img alt="image" class="img-circle" *ngIf="ticket?.user_info?.profile_image_url" src="{{ticket?.user_info?.profile_image_url}}">
                            <img alt="image" class="img-circle" *ngIf="!ticket?.user_info?.profile_image_url" src="assets/images/missing_profile_picture.jpg"> -->
                          </a>
                          <div style="padding-top: 5px">
                            <h4>{{ticket?.user_info?.first_name | titlecase}} {{ticket?.user_info?.last_name | titlecase}}</h4>
                          </div>
                        </div>
                      </td>
                      <td class="text-center">
                        {{ticket?.account_id}}
                      </td>
                      <td class="text-center">{{ticket?.ticket_type_name}}</td>
                      <td class="text-center" name="ticket-name">{{ticket?.details?.title}}</td>
                      <td class="text-center">
                        <img class="img-responsive" alt="image" *ngIf="ticket?.details?.images && ticket?.details?.images.length > 0" src="{{ticket?.details?.images[0]}}" height="30px" width="30px" />
                        <img class="img-sm"
                             *ngIf="!ticket?.details?.images || ticket?.details?.images.length == 0"
                             src="assets/images/placeholder_image.png">
                      </td>
                      <td class="text-center">
                        <span class="label" [ngClass]="setClass(ticket?.ticket_status_id)">{{ticket?.ticket_status_name}}</span>
                      </td>
                      <td>
                        <div class="input-group m-b">
                          <div class="input-group-btn" dropdown>
                            <button tabindex="-1" class="btn btn-white" type="button" [routerLink]="['/tickets/', ticket.id]">View Ticket</button>
                            <!-- <button class="btn btn-white dropdown-toggle" type="button" dropdownToggle>
                              <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu"  *dropdownMenu class="dropdown-menu">
                              <li>
                                <a href="#">Print Ticket/Attachments</a>
                              </li>
                              <li>
                                <a href="img/CUSTOMERNAME_Ticket.docx" download="CUSTOMERNAME_Ticket.docx" style="color:inherit;">Download Ticket/Attatchments</a>
                              </li>
                            </ul> -->
                          </div>
                        </div>
                      </td>
                    </tr>

                    <tr *ngIf="ticket?.ticket_type_id == 11">
                      <td>{{ticket?.id}}</td>
                      <td class="text-center">
                        <h4>
                          {{ticket?.date_created | date: 'mediumDate'}}
                        </h4>
                        <small>
                          {{ticket?.date_created | dateDiff}}
                        </small>
                      </td>
                      <td colspan="6" class="view-signup text-center">
                        <h4>New Signup Request</h4>
                        <i class="fa fa-user-plus"></i>
                      </td>
                      <td>
                        <button tabindex="-1" class="btn btn-white" type="button" [swal]="goToRequestsSwal" >Go to Signup Requests</button>
                      </td>
                    </tr>
                  </tbody>

                  <tbody fxShow.gt-xs="false" fxShow="true"  class="borderless-table" *ngFor="let ticket of (tickets$ | async)?.tickets">
                    <tr (click)="showTicketDetail(ticket.id)" class="mobile-table-buttons table-break mobile-td" *ngIf="ticket?.ticket_type_id != 11">

                      <!--TICKET INFO-->
                      <td>
                        <div>
                        <small> <strong>ID #:</strong> <br>
                         {{ticket?.id}}
                        </small>
                        <br>
                        <small> <strong>Title:</strong> <br> {{ticket?.details?.title}}</small>
                        <br>
                        <small> <strong>Date:</strong>  <br>
                        {{ticket?.date_created | date: 'mediumDate'}}
                        </small><br>
                        <small>
                          {{ticket?.date_created | dateDiff}}
                        </small>
                      </div>
                      </td>
                      <!--CUSTOMER INFO-->
                      <td *ngIf="user?.user_type_id !=3">
                        <div>
                        <div class="feed-element" >
                            <h5>Name:</h5>
                            <small>{{ticket?.user_info?.first_name | titlecase}} {{ticket?.user_info?.last_name | titlecase}}</small>
                        </div>
                        <h5>Account #:</h5><small> {{ticket?.account_id}}</small>
                       </div>
                      </td>
                      <td class="text-center" *ngIf="user.user_type_id ==3">
                            <h5>{{ticket?.account_id}}</h5>
                      </td>
                      <td class="text-center" *ngIf="user.user_type_id ==3">
                          <div>
                          <div class="feed-element" >
                              <span class="label" [ngClass]="setClass(ticket?.ticket_status_id)">{{ticket?.ticket_status_name}}</span>
                          </div>
                          </div>
                        </td>
                    </tr>

                    <tr [swal]="goToRequestsSwal" class="mobile-table-buttons table-break mobile-td" *ngIf="ticket?.ticket_type_id == 11">
                      <td>                        <span class="label" [ngClass]="setClass(ticket?.ticket_status_id)">{{ticket?.ticket_status_name}}</span> <br>
                      <small> <strong>ID #:</strong> <br>
                         {{ticket?.id}}
                        </small><br>
                        <small><strong>Date: </strong> <br>
                        {{ticket?.date_created | date: 'mediumDate'}}
                        </small><br>
                        <small>
                          {{ticket?.date_created | dateDiff}}
                        </small>
                      </td>
                      <td colspan="6" class="view-signup text-center" style="vertical-align: middle;">
                        <div>
                        <h4>New Signup Request</h4>
                        <i class="fa fa-user-plus"></i>
                       </div>
                      </td>
                    </tr>
                  </tbody>

                  <tbody  fxShow.xs="false" fxShow.gt-md="false" fxShow="true"  class="borderless-table" *ngFor="let ticket of (tickets$ | async)?.tickets">
                      <tr *ngIf="ticket?.ticket_type_id != 11" class="table-break mobile-td">
                        <td class="table-break">{{ticket?.id}}</td>
                        <td class="text-center">
                          <h4>
                           {{ticket?.date_created | date: 'mediumDate'}}
                          </h4>
                          <small>
                            {{ticket?.date_created | dateDiff}}
                          </small>
                        </td>
                        <td class="text-center" *ngIf="user?.user_type_id !=3">
                          <div class="feed-element">
                            <div>
                              <h4>{{ticket?.user_info?.first_name | titlecase}} {{ticket?.user_info?.last_name | titlecase}}</h4>
                            </div>
                          </div>
                        </td>
                        <td class="text-center">
                          {{ticket?.account_id}}
                        </td>
                        <td class="text-left" name="ticket-name">
                          <h5 style="margin-bottom:5px">Title:</h5>
                          <span>{{ticket?.details?.title}} </span>
                          <h5 style="margin-bottom:5px">Status:</h5>
                          <small class="label" [ngClass]="setClass(ticket?.ticket_status_id)">{{ticket?.ticket_status_name}}</small>
                        </td>
                        <td>
                          <div class="input-group m-b">
                            <div class="input-group-btn" dropdown>
                              <button tabindex="-1" class="btn btn-white ipad-requests-button" type="button" [routerLink]="['/tickets/', ticket.id]">View <br> Ticket</button>
                              <!-- <button class="btn btn-white dropdown-toggle" type="button" dropdownToggle>
                                <span class="caret"></span>
                              </button>
                              <ul class="dropdown-menu"  *dropdownMenu class="dropdown-menu">
                                <li>
                                  <a href="#">Print Ticket/Attachments</a>
                                </li>
                                <li>
                                  <a href="img/CUSTOMERNAME_Ticket.docx" download="CUSTOMERNAME_Ticket.docx" style="color:inherit;">Download Ticket/Attatchments</a>
                                </li>
                              </ul> -->
                            </div>
                          </div>
                        </td>
                      </tr>

                      <tr *ngIf="ticket?.ticket_type_id == 11" class="table-break mobile-td" >
                        <td>{{ticket?.id}}</td>
                        <td class="text-center">
                          <h4>
                            {{ticket?.date_created | date: 'mediumDate'}}
                          </h4>
                          <small>
                            {{ticket?.date_created | dateDiff}}
                          </small>
                        </td>
                        <td colspan="3" class="view-signup text-center">
                          <h4>New Signup Request</h4>
                          <i class="fa fa-user-plus"></i>
                        </td>
                        <td>
                          <button tabindex="-1" class="btn btn-white ipad-requests-button" type="button" [swal]="goToRequestsSwal" >Signup <br> Requests</button>
                        </td>
                      </tr>
                    </tbody>
                </table>

              </div>
            </div>

            <div class="row">
              <hr>
              <div class="col-xs-6" style="text-align: left; padding: 20px">
                <div class="btn-group" dropdown [dropup]="true">
                  <button id="button-autoclose1" dropdownToggle type="button" class="btn btn-default dropdown-toggle" aria-controls="dropdown-autoclose1">
                    {{paginationPageLimit}}
                    <span class="caret"></span>
                  </button>
                  <ul id="dropdown-autoclose1" *dropdownMenu class="dropdown-menu" role="menu" aria-labelledby="button-autoclose1">
                    <li role="menuitem" [ngClass]="{'active': (paginationPageLimit == 10)}">
                      <a class="dropdown-item" (click)="paginationPageLimit=10; search();">10</a>
                    </li>
                    <li role="menuitem" [ngClass]="{'active': (paginationPageLimit == 15)}">
                      <a class="dropdown-item" (click)="paginationPageLimit=15; search();">15</a>
                    </li>
                    <li role="menuitem" [ngClass]="{'active': (paginationPageLimit == 20)}">
                      <a class="dropdown-item" (click)="paginationPageLimit=20; search();">20</a>
                    </li>
                    <li role="menuitem" [ngClass]="{'active': (paginationPageLimit == 30)}">
                      <a class="dropdown-item" (click)="paginationPageLimit=30; search();">30</a>
                    </li>
                    <li role="menuitem" [ngClass]="{'active': (paginationPageLimit == 50)}">
                      <a class="dropdown-item" (click)="paginationPageLimit=50; search();">50</a>
                    </li>
                  </ul>
                </div>
                <span class="items-per-page"> per page</span>
              </div>
              <div class="col-xs-6" style="text-align: right">
                <pagination [rotate]="true" [itemsPerPage]="paginationPageLimit" [totalItems]="paginationTotalTickets" [maxSize]="paginationMaxSize"
                  [(ngModel)]="paginationCurrentPage" (pageChanged)="pageChanged($event)" previousText="&lsaquo;" nextText="&rsaquo;"></pagination>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

</div>

<swal #goToRequestsSwal title="Go to the signup requests page?" text="Click OK to navigate to the signup requests page" type="warning" [showCancelButton]="true" (confirm)="goToSignupRequests()">
  </swal>
</div>

