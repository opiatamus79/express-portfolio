<div class="scrollable">
    <!-- <div class="row wrapper border-bottom white-bg page-heading">
        <div class="col-lg-10">
            <h2>{{globals.city}}</h2>
            <ol class="breadcrumb">
                <li>

                </li>
                <li class="active">
                    <a [routerLink]="['/']">{{globals.onlyCityName}}</a>
                </li>
            </ol>
        </div>
        <div class="col-lg-2">

        </div>
    </div> -->

    <div style="margin-left:0px" class="row m-t-lg">
        <div class="col-md-6">
            <div style="margin-left:8px">
                <h2 style="margin-bottom:8px">
                    {{user.first_name | titlecase}} {{user.last_name | titlecase}}
                </h2>
                <div [ngSwitch]="selectedAccount?.account_type_id">
                    <h4 *ngSwitchCase="1">Residential</h4>
                    <h4 *ngSwitchCase="2">Commercial</h4>
                    <h4 *ngSwitchCase="null">N/A</h4>
                </div>
            </div>
            <br>
            <table class="table m-b-xs account-row">
                <tbody>
                    <tr>
                        <td>
                            <strong>Account Number</strong>
                        </td>
                        <td>
                            <select [(ngModel)]="selectedAccount" (change)="onSelectAccount()" name="accounts" class="form-control input-sm m-b-xs" style="height:35px" >
                                <option  *ngFor="let account of accounts" [ngValue]="account">{{account?.id}}</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong>Service Address</strong>
                        </td>
                        <td>
                            {{selectedAccount?.service_address?.street_address || 'N/A'}}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong>Type</strong>
                        </td>
                        <td>
                            <!-- <span class="label label-success">{{selectedAccount.account_type_id || 'null'}}</span> -->
                            <span [ngSwitch]="selectedAccount?.account_type_id ">
                                <label *ngSwitchCase="1" class="label label-success">Residential</label>
                                <label *ngSwitchCase="2" class="label label-success">Commercial</label>
                                <label *ngSwitchCase="null" class="label label-success">N/A</label>
                            </span>
                            <!--<span><span *ngIf="selectedAccount?.account_type_id == 1;else commercial" class="label label-success">Residential</span> <ng-template #commercial><span class="label label-success">Commercial</span></ng-template></span> -->
                        </td>
                    </tr>
                    <tr>                        
                        <td>
                            <strong>Status</strong>
                        </td>
                        <td>
                            <span><span *ngIf="user.active;else inactive" class="label label-success">Active</span> <ng-template #inactive><span class="label label-danger">Inactive</span></ng-template></span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div style="padding-left:0px" class="col-md-6 col-xs-12">
            <div class="ibox float-e-margins">
                <div class="ibox-content no-padding">
                    <div class="ibox-title">
                        <h5>Billing</h5>
                    </div>
                    <div [hidden]="infoLoading" class="ibox-content">
                        <div class="chart-container" style="position: relative; height: 200px;">
                            <canvas
                                id="billingChart">
                            </canvas>
                            <div [hidden]="sixMosData_comparitiveBill">
                                <h1>N/A</h1>
                            </div>
                        </div>
                        <div class="m-t-md">
                            <small class="pull-right">
                                <i class="fa fa-clock-o"> </i>
                                Update on {{today || 'N/A'}}
                            </small>
                            <small>
                                Billing History (6 months)
                            </small>
                        </div>
                        <!-- <div class="flot-chart">
                            <div class="flot-chart-content" id="flot-bar-chart_2" style="padding: 0px; position: relative;">
                                <canvas class="flot-base" width="475" height="114" style="direction: ltr; position: absolute; left: 0px; top: 0px; width: 475.5px; height: 114px;"></canvas>
                                <div class="flot-text" style="position: absolute; top: 0px; left: 0px; bottom: 0px; right: 0px; font-size: smaller; color: rgb(84, 84, 84);">
                                    <canvas class="flot-overlay" width="475" height="114" style="direction: ltr; position: absolute; left: 0px; top: 0px; width: 475.5px; height: 114px;"></canvas>
                                </div>
                            </div>
                        </div> -->
                    </div>
                </div>
                <div [hidden]="!infoLoading" class="sk-spinner sk-spinner-circle dashboard-spinner">
                    <div class="sk-circle1 sk-circle"></div>
                    <div class="sk-circle2 sk-circle"></div>
                    <div class="sk-circle3 sk-circle"></div>
                    <div class="sk-circle4 sk-circle"></div>
                    <div class="sk-circle5 sk-circle"></div>
                    <div class="sk-circle6 sk-circle"></div>
                    <div class="sk-circle7 sk-circle"></div>
                    <div class="sk-circle8 sk-circle"></div>
                    <div class="sk-circle9 sk-circle"></div>
                    <div class="sk-circle10 sk-circle"></div>
                    <div class="sk-circle11 sk-circle"></div>
                    <div class="sk-circle12 sk-circle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- <div class="col-lg-4">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <span class="label label-success pull-right">Daily</span>
                    <h5>Current Balance</h5>
                </div>
                <div [hidden]="infoLoading " class="ibox-content" >
                    <div class="row">
                        <div class="col-sm-6">
                            <h1 class="no-margins">{{(currentBalance | currency) || 'N/A'}}</h1>
                        </div>
                        <div class="col-sm-6 text-right">
                            <a *ngIf="sixMosData_currentbalance" tooltip="View Current Bill Balance" class="btn btn-sm btn-success" [routerLink]="['/bills/:id', {id: currentBillId}]" style="color: white;">View</a>
                            <a *ngIf="!sixMosData_currentbalance" class="btn btn-sm btn-success" style="color: white; cursor: not-allowed;"> View</a>
                        </div>
                    </div>
                </div>
                <div class="ibox-content dashboard-bounce-spinner" [hidden]="!infoLoading">
                    <div>
                        <div class="sk-spinner sk-spinner-three-bounce">
                            <div class="sk-bounce1"></div>
                            <div class="sk-bounce2"></div>
                            <div class="sk-bounce3"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div> -->
        <div class="col-lg-4">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <span class="label label-success pull-right">Daily</span>
                    <h5>Account Balance</h5>
                </div>
                <div [hidden]="infoLoading " class="ibox-content" >
                    <div class="row">
                        <div class="col-sm-6">
                            <h1 class="no-margins">{{ (cumulativeBalance | currency) || 'N/A' }} </h1>
                        </div>
                        <div class="col-sm-6 text-right" *ngIf="selectedAccount">
                            <a [routerLink]="['/payments/new/', selectedAccount.id]" tooltip="Make a payment" class="btn btn-sm btn-success" style="color: white; "> Make a payment</a>
                        </div>
                    </div>
                </div>
                <div class="ibox-content dashboard-bounce-spinner" [hidden]="!infoLoading">
                    <div>
                        <div class="sk-spinner sk-spinner-three-bounce">
                            <div class="sk-bounce1"></div>
                            <div class="sk-bounce2"></div>
                            <div class="sk-bounce3"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <span class="label label-success pull-right">Monthly</span>
                    <h5>Next Payment Due Date</h5>
                </div>
                <div [hidden]="infoLoading" class="ibox-content">
                    <h1 class="no-margins">{{dueDate || 'N/A'}}</h1>

                </div>
                <div class="ibox-content dashboard-bounce-spinner" [hidden]="!infoLoading">
                    <div class="">
                        <div class="sk-spinner sk-spinner-three-bounce">
                        <div class="sk-bounce1"></div>
                        <div class="sk-bounce2"></div>
                        <div class="sk-bounce3"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4" >
            <div class="ibox float-e-margins" >
                <div class="ibox-title">
                    <h5>Last Payment Received</h5>
                </div>
                <div class="ibox-content" id="lastPayment_panel_1">
                    <div [hidden]="infoLoading" class="row">
                        <div class="col-xs-6">
                            <h2 class="no-margins h4">Period:</h2>
                            <p>{{lastPaymentPeriod || 'N/A'}}</p>
                        </div>
                        <div class="col-xs-6" >
                            <h2 class="no-margins h4"> Received:</h2>
                            <p>{{latestPayment  || 'N/A'}}</p>
                        </div>
                    </div>
                    <div class="ibox-content dashboard-bounce-spinner" [hidden]="!infoLoading">
                        <div>
                            <div class="sk-spinner sk-spinner-three-bounce">
                            <div class="sk-bounce1"></div>
                            <div class="sk-bounce2"></div>
                            <div class="sk-bounce3"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row" style="padding-bottom: 30px;">
        <div class="col-lg-6">
            <tabset #graphTabs>
                <tab style="margin-top:0px" heading="Consumption" [active]="true" #1 >
                    <div class="ibox float-e-margins">
                        <div [hidden]="infoLoading" class="ibox-content">
                            <div>
                                <span class="pull-right text-right" *ngIf=" consumptionAverage && !consumptionAverage.includes('NaN')">
                                    <small>Average value of usage in past 6 months</small>
                                    <br/>
                                    {{consumptionAverage || 'N/A'}}
                                </span>
                                <h3 class="font-bold no-margins">
                                    Consumption Rate
                                </h3>
                                <small>Water Consumption</small>
                            </div>

                            <div class="m-t-sm">
                                <div class="row">
                                    <div class="col-md-9">
                                        <div>
                                            <canvas id="consumptionChart" width="537" height="268"  style="width: 537px; height: 268px;"></canvas>
                                        </div>
                                        <div [hidden]="sixMosData_waterUsage">
                                            <h1>N/A</h1>
                                        </div>
                                    </div>

                                    <div class="col-md-3">
                                        <ul class="row stat-list m-t-lg">
                                            <li *ngIf="paidAverage && !paidAverage.includes('NaN') ">
                                                <h2 class="no-margins">{{paidAverage || 'N/A'}}</h2>
                                                <small>Average amount paid for each month</small>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="m-t-md">
                                <small class="pull-right">
                                    <i class="fa fa-clock-o"> </i>
                                    Update on {{today || 'N/A'}}
                                </small>
                                <small>
                                    Water Use History (6 months)
                                </small>
                            </div>
                        </div>
                        <div [hidden]="!infoLoading" class="sk-spinner sk-spinner-circle dashboard-spinner">
                            <div class="sk-circle1 sk-circle"></div>
                            <div class="sk-circle2 sk-circle"></div>
                            <div class="sk-circle3 sk-circle"></div>
                            <div class="sk-circle4 sk-circle"></div>
                            <div class="sk-circle5 sk-circle"></div>
                            <div class="sk-circle6 sk-circle"></div>
                            <div class="sk-circle7 sk-circle"></div>
                            <div class="sk-circle8 sk-circle"></div>
                            <div class="sk-circle9 sk-circle"></div>
                            <div class="sk-circle10 sk-circle"></div>
                            <div class="sk-circle11 sk-circle"></div>
                            <div class="sk-circle12 sk-circle"></div>
                        </div>
                    </div>
                </tab>
                <tab #2  style="margin-top:0px" heading="Comparative">
                    <div [hidden]="infoLoading"  class="ibox float-e-margins">
                        <div class="ibox-title">
                            <span class="label label-primary pull-right">Annual</span>
                            <h5>Customers Comparative Graph</h5>
                        </div>
                        <div [hidden]="infoLoading" class="ibox-content">
                            <canvas id="comparativeChart"> </canvas>
                        </div>
                    </div>
                    <div [hidden]="!infoLoading" class="sk-spinner sk-spinner-circle dashboard-spinner">
                        <div class="sk-circle1 sk-circle"></div>
                        <div class="sk-circle2 sk-circle"></div>
                        <div class="sk-circle3 sk-circle"></div>
                        <div class="sk-circle4 sk-circle"></div>
                        <div class="sk-circle5 sk-circle"></div>
                        <div class="sk-circle6 sk-circle"></div>
                        <div class="sk-circle7 sk-circle"></div>
                        <div class="sk-circle8 sk-circle"></div>
                        <div class="sk-circle9 sk-circle"></div>
                        <div class="sk-circle10 sk-circle"></div>
                        <div class="sk-circle11 sk-circle"></div>
                        <div class="sk-circle12 sk-circle"></div>
                    </div>
                </tab>
            </tabset>
        </div>

        <div class="col-lg-6">
            <div style="margin-top: 38px;" class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>Billing History </h5>
                </div>
                <div [hidden]="sixMosData_payments">
                    <div class="ibox-content " >
                        <h1>N/A</h1>
                        <div class="m-t-md">
                            <small class="pull-right">
                                <i class="fa fa-clock-o"> </i>
                                Update on {{today}}
                            </small>
                            <small>
                                Billing History (6 months)
                            </small>
                        </div>
                    </div>
                </div>
                <div [hidden]="infoLoading || formattedBills?.length == 0" class="ibox-content">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>   
                                    <th>#</th>
                                    <th>Paid on</th>
                                    <th>Amount</th>
                                    <th>Payment Method</th>
                                    <th fxShow="false">Business Name</th>
                                    <!--<th>Water Consumption</th>-->
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let bill of formattedBills">
                                    <td>{{bill.id}}</td>
                                    <td>{{bill.paymentDateStatement}}</td>
                                    <td>${{bill.amount}}</td>
                                    <td>
                                        <span [ngSwitch]="bill.paymentMethod">
                                            <p *ngSwitchCase="1">
                                                Credit card
                                            </p>
                                            <p *ngSwitchCase="2">
                                                Cash
                                            </p>
                                            <p *ngSwitchDefault>
                                                Cash
                                            </p>
                                        </span>
                                    </td>
                                    <!-- <td fxShow="false">[not yet known]</td> -->
                                    <!--<td >{{bill.litersConsumed}} Lts</td>-->
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="m-t-md">
                        <small class="pull-right">
                            <i class="fa fa-clock-o"> </i>
                            Update on {{today}}
                        </small>
                        <small>
                            Billing History (6 months)
                        </small>
                    </div>
                </div>
                <div [hidden]="!infoLoading" class="sk-spinner sk-spinner-circle dashboard-spinner">
                    <div class="sk-circle1 sk-circle"></div>
                    <div class="sk-circle2 sk-circle"></div>
                    <div class="sk-circle3 sk-circle"></div>
                    <div class="sk-circle4 sk-circle"></div>
                    <div class="sk-circle5 sk-circle"></div>
                    <div class="sk-circle6 sk-circle"></div>
                    <div class="sk-circle7 sk-circle"></div>
                    <div class="sk-circle8 sk-circle"></div>
                    <div class="sk-circle9 sk-circle"></div>
                    <div class="sk-circle10 sk-circle"></div>
                    <div class="sk-circle11 sk-circle"></div>
                    <div class="sk-circle12 sk-circle"></div>
                </div>
            </div>
    </div>
</div>